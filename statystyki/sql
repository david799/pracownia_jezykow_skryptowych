CREATE TABLE ORDERS(id INTEGER PRIMARY KEY AUTOINCREMENT, order_date DATE, new_client INTEGER, marketing_permit INTEGER, sex INTEGER, delivery_place TEXT, discount_code TEXT);
CREATE TABLE MEALS(id INTEGER PRIMARY KEY AUTOINCREMENT, order_id INTEGER, meal_name TEXT, meal_price REAL, category_name TEXT);
CREATE TABLE ADDITIONS(id INTEGER PRIMARY KEY AUTOINCREMENT, order_id INTEGER, addition_name TEXT, addition_price REAL);
CREATE TABLE CAMPAIGNS(id INTEGER PRIMARY KEY AUTOINCREMENT, campaign_name TEXT, campaign_type INTEGER, messages_count INTEGER);

<?php
include 'cors_headers.php';

function edit_order()
{
    $json_path = 'jsons/orders.json';
    $orders_to_print_json_path = "jsons/orders_to_print.json";
    if (file_exists(dirname(__FILE__) . $json_path))
        return "Orders JSON does not exist";
    if (file_exists(dirname(__FILE__) . $orders_to_print_json_path))
        return "Orders to print JSON does not exist";
    $json = json_decode(file_get_contents($json_path), true);
    $recieved_json = json_decode(file_get_contents('php://input'), true, 512, JSON_UNESCAPED_UNICODE);
    $orders_to_print_json = json_decode(file_get_contents($orders_to_print_json_path), true, 512, JSON_UNESCAPED_UNICODE);
    if ($recieved_json == NULL)
        return "Recieved orders JSON is NULL";
    foreach ($recieved_json as $main_key => $values_array) 
    {
        if (!array_key_exists($main_key, $json)) {
            $json[$main_key] = $values_array;
            $orders_to_print_json[$main_key] = $values_array;
        }
        else{
            $json[$main_key]["progress"] = $values_array["progress"];
            // below is to edit all fields on order
            //foreach ($values_array as $key => $value) 
            //{
            //    $json[$main_key][$key] = $value;
            //}
        }
    }
    if (!file_put_contents($json_path, json_encode($json, JSON_UNESCAPED_UNICODE)))
        return "Cannot save edited orders";
    if (!file_put_contents($orders_to_print_json_path, json_encode($orders_to_print_json, JSON_UNESCAPED_UNICODE)))
        return "Cannot save orders to print";
    return "OK";
}

echo edit_order();

?>

<?php
include '../cors_headers.php';

function add_email()
{
  $recieved_json = json_decode(file_get_contents('php://input'), true);
  if ($recieved_json == NULL)
      return "Recieved marketing contact json is NULL";
  try  {  
    $db = new PDO("sqlite:stats.db");
    $phone_number = $recieved_json["phone_number"];
    $email = $recieved_json["email"];
    $results = $db->query("SELECT EMAIL, PHONE_NUMBER FROM CONTACTS");
    while ($row = $results->fetch(\PDO::FETCH_ASSOC)){
      if ($row['PHONE_NUMBER'] == $phone_number && $row['EMAIL'] == $email)
          return "Marketing info for that person already exist";
    }
    $restaurants_order_id = $recieved_json["restaurants_order_id"];
    $delivery_address = $recieved_json["delivery_address"];
    $delivery_city = $recieved_json["delivery_city"];
    $detected_gender = $recieved_json["detected_gender"];
    $payed_online = $recieved_json["payed_online"];     // Y for yes, N for no
    $orders_number = 1;
    $db->exec("INSERT INTO CONTACTS VALUES('$restaurants_order_id', '$email', '$delivery_address', '$phone_number', '$delivery_city', '$detected_gender', '$payed_online', '$orders_number')");
  }
  catch(PDOException $e) {
    echo $e->getMessage();
    echo "<br><br>Database <b>NOT</b> loaded successfully. ";
    die( "<br><br>Query Closed! $e");
  } 

  return "OK";  
}

echo add_email();
?>

